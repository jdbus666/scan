/*
活动名称：店铺关注有礼
活动链接：店铺首页关注按钮
环境变量：jd_drawShopGift_argv // 活动参数，支持两种格式：”<shopId(店铺id)>_<venderId(商家id)>“ 或 ”<活动店铺首页链接>“
        jd_drawShopGift_threads // 控制并发线程数（正整数），默认1，最大5
        jd_drawShopGift_interval // 自定义运行间隔时长（整数，单位毫秒），默认1000
        jd_drawShopGift_notify // 是否推送通知（true/false），默认不推送

⚠ 请勿滥用自动化工具解析的店铺链接作为变量使用本脚本！请确认活动有效性后再使用！
⚠ 因自动化程序滥用严重导致官方接口受影响，现在必须同时提供店铺和商家id才可运行！

高并发脚本，黑号领不到奖品
活动限制IP严重，建议使用代理，谨慎使用并发

cron:1 1 1 1 *

*/

const $ = new Env('店铺关注有礼')
var iｉl='jsjiami.com.v7';const ililIi=iii1II;function iii1II(_0x788259,_0x3fcbdd){const _0xad3210=Iii11l();return iii1II=function(_0x11b122,_0x47ca3e){_0x11b122=_0x11b122-0xaf;let _0x28eabc=_0xad3210[_0x11b122];if(iii1II['aXYUUb']===undefined){var _0x445eb8=function(_0x27d139){const _0x5f0103='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x29214a='',_0x5e79f0='';for(let _0xcde922=0x0,_0x27e611,_0x27a1c7,_0x17414f=0x0;_0x27a1c7=_0x27d139['charAt'](_0x17414f++);~_0x27a1c7&&(_0x27e611=_0xcde922%0x4?_0x27e611*0x40+_0x27a1c7:_0x27a1c7,_0xcde922++%0x4)?_0x29214a+=String['fromCharCode'](0xff&_0x27e611>>(-0x2*_0xcde922&0x6)):0x0){_0x27a1c7=_0x5f0103['indexOf'](_0x27a1c7);}for(let _0x2e4d9a=0x0,_0x4200d9=_0x29214a['length'];_0x2e4d9a<_0x4200d9;_0x2e4d9a++){_0x5e79f0+='%'+('00'+_0x29214a['charCodeAt'](_0x2e4d9a)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x5e79f0);};const _0x4dffdd=function(_0x23b4c0,_0x4899f3){let _0x46c19f=[],_0x1f5735=0x0,_0x477d40,_0x45ef0a='';_0x23b4c0=_0x445eb8(_0x23b4c0);let _0x502595;for(_0x502595=0x0;_0x502595<0x100;_0x502595++){_0x46c19f[_0x502595]=_0x502595;}for(_0x502595=0x0;_0x502595<0x100;_0x502595++){_0x1f5735=(_0x1f5735+_0x46c19f[_0x502595]+_0x4899f3['charCodeAt'](_0x502595%_0x4899f3['length']))%0x100,_0x477d40=_0x46c19f[_0x502595],_0x46c19f[_0x502595]=_0x46c19f[_0x1f5735],_0x46c19f[_0x1f5735]=_0x477d40;}_0x502595=0x0,_0x1f5735=0x0;for(let _0x5cdad6=0x0;_0x5cdad6<_0x23b4c0['length'];_0x5cdad6++){_0x502595=(_0x502595+0x1)%0x100,_0x1f5735=(_0x1f5735+_0x46c19f[_0x502595])%0x100,_0x477d40=_0x46c19f[_0x502595],_0x46c19f[_0x502595]=_0x46c19f[_0x1f5735],_0x46c19f[_0x1f5735]=_0x477d40,_0x45ef0a+=String['fromCharCode'](_0x23b4c0['charCodeAt'](_0x5cdad6)^_0x46c19f[(_0x46c19f[_0x502595]+_0x46c19f[_0x1f5735])%0x100]);}return _0x45ef0a;};iii1II['hdcrtd']=_0x4dffdd,_0x788259=arguments,iii1II['aXYUUb']=!![];}const _0x38d8e3=_0xad3210[0x0],_0x5819e0=_0x11b122+_0x38d8e3,_0x5670d6=_0x788259[_0x5819e0];return!_0x5670d6?(iii1II['FeyuIB']===undefined&&(iii1II['FeyuIB']=!![]),_0x28eabc=iii1II['hdcrtd'](_0x28eabc,_0x47ca3e),_0x788259[_0x5819e0]=_0x28eabc):_0x28eabc=_0x5670d6,_0x28eabc;},iii1II(_0x788259,_0x3fcbdd);}(function(II1iI,llI1II,lIli1l,lillIi,illIi1,ii1ili,liil1i){return II1iI=II1iI>>0x5,ii1ili='hs',liil1i='hs',function(lI1lil,i1l1iI,liil1l,lI1lii,Iiili1){const liiI1i=iii1II;lI1lii='tfi',ii1ili=lI1lii+ii1ili,Iiili1='up',liil1i+=Iiili1,ii1ili=liil1l(ii1ili),liil1i=liil1l(liil1i),liil1l=0x0;const Iil1l1=lI1lil();while(!![]&&--lillIi+i1l1iI){try{lI1lii=parseInt(liiI1i(0x1c7,'b$v$'))/0x1+parseInt(liiI1i(0xbe,'Gcrg'))/0x2+parseInt(liiI1i(0x15b,'Rtwa'))/0x3*(-parseInt(liiI1i(0xc0,'YxA%'))/0x4)+-parseInt(liiI1i(0xd6,'e#6x'))/0x5+-parseInt(liiI1i(0x11c,'lF9g'))/0x6+parseInt(liiI1i(0x1d2,'47lQ'))/0x7+parseInt(liiI1i(0xb8,'lF9g'))/0x8*(parseInt(liiI1i(0x1d0,'Rz[K'))/0x9);}catch(i1i11I){lI1lii=liil1l;}finally{Iiili1=Iil1l1[ii1ili]();if(II1iI<=lillIi)liil1l?illIi1?lI1lii=Iiili1:illIi1=Iiili1:liil1l=Iiili1;else{if(liil1l==illIi1['replace'](/[krnExgLlTNIGSdYMtQ=]/g,'')){if(lI1lii===i1l1iI){Iil1l1['un'+ii1ili](Iiili1);break;}Iil1l1[liil1i](Iiili1);}}}}}(lIli1l,llI1II,function(il1iIl,iii1ii,il1iIi,iii1il,II11li,I1l11i,iIIiiI){return iii1ii='\x73\x70\x6c\x69\x74',il1iIl=arguments[0x0],il1iIl=il1iIl[iii1ii](''),il1iIi=`\x72\x65\x76\x65\x72\x73\x65`,il1iIl=il1iIl[il1iIi]('\x76'),iii1il=`\x6a\x6f\x69\x6e`,(0x165d0e,il1iIl[iii1il](''));});}(0x1820,0xafa89,Iii11l,0xc3),Iii11l)&&(iｉl=`\xdf4`);const jdCookie=require(ililIi(0x157,'K(u[')),common=require(ililIi(0x124,'47lQ')),notify=require(ililIi(0x169,'D@7@'));console[ililIi(0x13f,'j9Ii')](''),console[ililIi(0x13f,'j9Ii')]('=========='+$[ililIi(0xbf,'$2IK')]+ililIi(0x19e,'Gcrg')),console[ililIi(0x16b,'VgU!')]('jd_drawShopGift_argv\x20//\x20活动参数'),console['log']('jd_drawShopGift_threads\x20//\x20控制并发线程数，默认1'),console['log'](ililIi(0x122,'#V9t')),console[ililIi(0x138,'Q!C0')](ililIi(0x156,'v#]y')),console[ililIi(0x1a5,'B*uP')](ililIi(0x101,'5uYz')+$[ililIi(0x1d6,'lF9g')]+'提示结束=========='),console[ililIi(0x146,'#PGI')]('');function Iii11l(){const I1l11l=(function(){return[...[iｉl,'gkMjNksEjxGiQaLrmNditd.YTtcIoSmt.lvQQ7Yn==','W6GqW6pcICka','W5VdS14l','rSkeue9L','WO3cGqtcUSk1','W515xfSloq3dQKZcICkFWOrg','hHjrW7vDW7zrWQ0','srDpW7vpWRqqWRO','quNcO8ooW78','m1mkW5NdRG','W4ONW6BcVCkihXRdHq','xMtcPsu','jx/dR8ogiCkqW6eOWRLlomkiWQddVNPXW4a','WRKVcWLF','WODKCa','W43cLmoUWRHn','W4CGxXRdNa','WPriWRPxfCkL','xs9QBCo8W5y','jmo7W73dP8o6EG','k285W6FdReddUa','cCoVqCkDiu4','xhhcTa','D23cPmoVW7m','phddRSoqnSkX','vMVdSCkDs8kjWOGN','W6NcGmkWqCk1WQW','WR9xWRbseG','5BUw6zci5lQU5A+B5zY65OQM6i2S5y2y5BUd6zcI5l295OgA5Asm6lAn','qSorl2moFSoeWPhcL8okWQa7W6m','WRTDdCkxW6K','WRddMu/dS8o/','xZTiECoE','ervk','osNdTdDvW5pcOr4','gapdJa','W5VcJeXqW5O','W7mjqrddN30r','a8kGW4mpWQ4pq0i','qCoWW70aWQCYxfy','AhlcQ2iiWPhdTdCNW69dWQLf','WPXQFJ5NW51jWQi','i3VdS8oriCk3W5OG','WRJcUYe','l8ktW47dPG','vmk3bSo7WQm','aSomACkvea','ymkYrbFcVG','WRdcPqK','hmkydrdcH8klW6KyWQa1k8o1WQPZWOXS','5RAh5yUQ5lQf5A6b5z+f5OM75BAH6AcN6lYP','W6RcH3PXW6q','oYFdRdO','W7KqWPhdLCofWRVcUSo5','vv3cVfS','dCkyfZ3cJmkvW4Ks','WRtcNLNcQgvN','W4C2uaFdUW','xCkxysBcM3BdR3Sdwafl','sSkvl8oIWRFdIty','W70crIBdHg4','DWb0W6LQ','WQBcVdtcKSk2WRvRlCkB','BSkDDN1z','W4/cO8krwSkr','kmkXeWdcGW','du3dJ8opeq','WP/dIG/cGCoL','WRnFWQhdKSo6','5lUj56655zkc5BU46zkm6kYf5A+k5y+q5lUF5lMk5727','W5KoxCos','8jgkUfC','h3lcOG','EmohWPxcTcdcImkcW4esWQ7dLvq','fSknAa','WQLFWRZdH8oAaW','ng8UW4pdOLxdUq','d8odW6VdVmoh','BfRdRSk2sq','WQFdMSo8WOlcU27dRJxcLmogw8kK','W7fdW6ZcRG','W63dVLzhWP0+WOXMmYhdQSki','mLNdN8owna','44ox5OYM56sm44oj6k+B5ywl6i2Y5yYDFKxcL8o8WRXj','WO/cQaOAW40','qvGWWPW9','ethcNa08WRK','oUIUNUAXM+wKUoI2ISkN4P2YCW','BL7cPNPO','eSkTfd7cQW','WQHBraXb','WO7dVmoJgda','e8o0FCkyc0L/W4yH','dCobAmkhja','5P6355YF5RA55yM454QV5Ooq','WQldSmoMaXNdJan6WR7cGa','WQDRWPD7ba','WQBcKIJcL8kO','v0RcP1PJqmoSWRi','W5KluCokWRNdMHxcSJZdR8o0WR0','WOu4gYrvBvO','t3yzWOaGWRadEG','W48QW6FcQCkKcq','oKhdRCkqjvr3W53dPsxcKHBcGq','xSkzmSo2WRFdKq'],...(function(){return[...['WQj9rsjc','W7WuWOVdLmo9WQy','h23cIXqu','W6ZdVxddJmoQW6PBbmkKW7P/W5O','wSkzl8oNWR7dLWz1','W7hcLCoL','WP9tWQbeb8oRWQFdM8o0WPddSmkKotuKAmkwWR/cO8ogWQLTgSojW5SGpmkVFCoUW5ZcUZldHq','qmkOc8oPWOi','6i+a5y6Q5Rsj5yIX5l+j5Oo95Asf6lE7','5BMq6zcm5zYg5z6y77Y2A8kXWR9nwCocWRJdUL/cINDlW4GFW4e9W4zXygWktmoVWOZdTvFdPSo7mSkz','zCkvhqddMW','WRlcRsJcRSkz','rNdcUbDoluO','Ca1gBCoDW6BcMqddU8oXW7z8W63dLJtdPCkgx2vjWPn7','5PYp552i5AA65zom6Ag05y2x54UQ5Okwvq','W77cLSoNWQfl','EsTmsSoe','W53dPeum','8jM7GJK','W7ZdJMiXmG','FWDV','zeldRCkVwa','WOZdNM/dT8o3oW','fCkkzG','uY1btCoH','WPTiWRm','WQ7cRX0eW4D6','FqXTwSogW6dcGa','WO7dJ0pdSSoYiq','kvpcNHi0','5P2t55++5AAm5zkJ6Aot5y+A54Qf5Ok6','bYhcMGK','vhyeWPCKWQuV','W4VcGwDAW6Tb','WOaPmazlBuRdTeJcR8kwWQbcsHVdN8oCg8kjjvBdNmoY','5BIb6zcu5zob56wl776xDq','jmoMW7BdPCoAFSkJWOu','WRdcHhtcOeC','xgiaWQa2','WPWOaqzCFNtdGW','w2tcOJvniq','WOpcTGPcrmo7mKVdQSkH','t8kaBJxcRwZdIw8','Aqf2ECoMW6m','u2BdSmkjz8kF','AWLutSoz','smoEWOS','4PMTjoIfTowULUs7JEI8QoIJJUMuJEMBVEAvGoMvM+ISToE9NUMxOoISPq','WQPEtWbs','4P2GW5ZMNAVOGB7MRRJNO4VLPyVNKjDe','6lEt5yYO5Psq5PER','sCocWOS','WRvpWQhdIa','W7RcN8o2WOnXWR4DW6jSW4hdPIKQfs0IW48IBxFdMmkrW6y','c27cTcC7Aa','u8k0AqhcQG','wb9E','W7nhW6/cReVcVW','q27cV8oUW7m','WPldLhVdH8oPpq','WO55zsvb','W6VdU0iEma','FXJcQSotDJu1W4VdNZdcJZRcOmktzCoTWPy','8lQ0V++7GW','sNSyWPqAWQm6BSozWRtdSSk9AmkUCCk6bmk3','s8k7a8oGWQS','C3CvWOST','WRdcL1/cRhHQWQJcRG','C8odWPpcSspcHmoJW6uNWRhdSwDv','wgRcTsvi','v8oyWOjiWPZdPq','WR5SW7f8W43cNa','DI/dO8k3WRFcJW','xmo0W74YWOu','ASksnsVdOaXjwmkxWQOKW5iXbIFcTeP7W7BdQbytkX7cPSoecftOH5pLRAtKUkFOViJOOzZPL5RPM4VML5dPL6xVV6dPUO7ORORcRLuzWQm','qx7dR8kvr8kyWQa3zmk4wMembWZcRmkJW6JcQfpdHqjVAsBcMZldSKFcN8kkuCkC','CwNdRs9tW4JcT1uzW4nyWQ9eimkICmkRW7VcSCkfWQ3cLKu','hxRcRGm','yXBcVW','WOxcHehcRKe','ncXHW59A','W6imh8oufG','C8k5WQ3cTSk+l8oGW57cOq','WPBcSmkEW4abW4C','bmkcDYnJjCkqWRy','W5JdOK8','xSkaDbVcJvy','WR/cPqOu','sxVcSmoeW7e','ocpdRbDvW4pcRrqyW5jBWR5Dia','pmkipGpcSa','t8ojWRnPWOddOcVdHb13WOyjgNBcKgO/W6/cTMO','W4yjEbhdSG','i8orqmkLkW','WQRcRWavW458WOTi','rwRcQW','gXnv','WO4FWQblwa','Fb9iF8oU','W7dcH8kGW4/dQcq','wUITSoAXRowNNoI1JqRINOBcLEAwSUwqJow5HEAvT+AoNW','BfG5WO8O','hgJdJ8oDnq','WQLvWRu','wdT+W6nZ','WQfRW7K'],...(function(){return['WPtdGc3cSmox','W4xcI3PkW6TsWO8','twVdRmkkt8kCWQq','xCkAqvb1','f8kshG','WQ3cPK/cJN4','WOrpWRTeoSkWW6xcKq','4PQfWO3ORjVMJ53KVANLRi3MLkJKVBBMGjRLKjBLHBVOVP7OOl/OHiRMN4G','mSkgW5hdQNZdL8kYW6GT','WONdKNNdTmo3','gCksfJxcJmkgW64','xwewWPmwWQOLBSobWRxdU8kK','WR1qWRJdQ8ou','mNpdImoZaq','xaHVBSoE','WPtcVmkeW4OwW5RdMCo3sSkl','FbPprSoe','AMlcMdbt','WQtdN8o8WONcVglcPXxcJ8oHymkVW6u','zW3cRmoqyfPOWOJdRIhcLhxcOmoyE8oSW4PEoCohW4NdNNWdWPzTFrCkWRPpjey1','m24cW5tdSvpdQ8o0lCofdmkpW5eTWPVdPCoZq8oUW7e2WQ5ybCoEW4ZMM4ZLKPxPG4tNNkFdSv5qWPqiWRNcJXhcGw3dLCon77216BUr6kYe5lUd5O2Y6ycH','f8okAJxcI3hdR2aTva','sfeLWO4r','WRLfWODfea','W7xcGCkIW5JdRci','W548ucH1W5fEWRy','WRlcRtlcQmkWWR1Yd8khW7HxW5ldPG','WRXXW7T+W73cQ8o2WOSaW5HdW55FWRBcQdLDW6Se','AZPT','pe7dSmosbG','WQRdVSoNcG','W4JdRLKBhmk0rHi','FSkiuenkrby','t8oJW4qrWRi','WQjFWQBdQCoab8o4WQBcNmoqW67dIvuwtra','dJBcLa','EwJcGCoVW7y','tgVcUG','W6hcMfTrW7S','W4rIgHzqye7cIhlcPCkeWOjhxZddS8onhCkFcNpdTSoUW5W6oSoT','tghdUa','tudcRG','qZvJ','4P+YWQVOHk3MNzpOVQNOOORPGyJLIyBKUzhPLOxORyqO','WQ3cKMNcVf5IWRlcMfvfWOJdKmk8sSkwr1xcIqBcHJhdMW','WQ1YxafP','e3/cHqyNButdQmofWQ3dOMnWW7ODmqpcG0JdL8kKEJjC','rKRcVxDOxSomWRJcO1DeWQhcKMZdUdS','W7ZcMCo2WRLVWRGzW5nkW4G','xG5vqCoI','mmoOW7hdSG','CSktgtRdVHK','WPTxbSkmW4BcJG','v3VcP8oeW6JdKf7cU0tcQSkDjmougG','W5dcNK5JW7W','W4xcH2C','WOTCcmkfW7K','WQ1oWQBdKmoDuCk+W6C','u23dG0rdW6ufomoSWOu3uG','DXngACo/','uCklvrZcMG','W5RcM2D8W6rr','WPldLhS','nwu6','W5NdRKm2f8kQzHJcSSoFW4rmESkrnCoa','W7ZcGCkN','C8kgbIBdPG','W4ZJGyxLUytPK4VLNkhLNOhJGynWW4VcI1XtW6/cMCkaWQD2e2ijDtBdP2L2WROfDx7cPmoqW6tdT8kZl8kBW7q','h8kmEq','W7vLW70','WPddMNhdPW','5y+Y5lIq5REO5yIV5OQx5yIG5l2Z5P+46AkN5yYQ5yUm5AsE5zgG7723','sSkvoq','WOXUyWnDW5HnWQNdSetdMSoeW4dcHvXY','hCo9AmkMiW','gwBdRmorpa','WQpcRsJcN8k9WQbllW','WPNcSmkx','kmkLW4ldThC','W6tcI8kTW4NdMJNdRrO','WQO6WRq','WPpdUhldI8oQ','BmopWOHFWOO','o0lcOdmn','W5O7j3O','hmkWtZ9H','WR9XW7bjW6RcNa','Cmo4WOfVWRK','kSkxW4BdSZ/dKCk3W6CIWR0','8lIDPE+6Jq','EEodS+w6IEMsREwqUUEMVoodRmoW','4PUBW53ORO7LOllLHBdMO5VLVO/MRjxNOQVNM7lNJ6VLOjJLJiBPH5K','5y2o6ysH6kY45PQ1WRbRWQjdW4hcTtddGmkWlq','WPHJEdPXW5vxWQldNgNdK8of','yCkmwfm','5PYl55+k5REY5yQw54QW5OcZWOu','W5tcVUs6J+wpQEMfLa','C8kEbt/dMWK','44ke5O6856sp44gs6k2b5yws6i+i5yYfWQaGWPNdJ8k8uG','W4tcGw4','fNNdICounq','Eqz3B8ogW6a','k8oMW78','cNpcTriCAa','FrZcQCovDHmZ'];}())];}())];}());Iii11l=function(){return I1l11l;};return Iii11l();};const activityArgv=process['env'][ililIi(0x133,'Z()M')]||'';let taskThreads=process['env'][ililIi(0xfa,'D@7@')]||'1';const runInterval=process[ililIi(0xec,'Osoa')][ililIi(0x170,'E76f')]||ililIi(0x196,'Rtwa'),isNotify=(process[ililIi(0x167,'CPba')][ililIi(0x16e,']IJI')]||process[ililIi(0xb9,'b$v$')][ililIi(0xe5,'Osoa')])===ililIi(0x1e0,'VgU!'),cookiesArr=Object['keys'](jdCookie)['map'](lll=>jdCookie[lll])[ililIi(0x13b,'Gcrg')](llli1=>llli1);!cookiesArr[0x0]&&($[ililIi(0x1d5,'M]cs')]($['name'],ililIi(0xc2,']IJI')),process[ililIi(0xf7,'6s2M')](0x1));!(async()=>{const lilIIl=ililIi,iIli1i={'AUXJa':function(iI1lii){return iI1lii();}};notify[lilIIl(0x1a7,'Osoa')]({'title':$[lilIIl(0x188,'#H2P')]}),await iIli1i[lilIIl(0x108,'Rtwa')](Main),isNotify&&notify['getMessage']()&&await notify[lilIIl(0x10c,'j9Ii')]();})()['catch'](IilIii=>$[ililIi(0x113,'#H2P')](IilIii))[ililIi(0x1e5,'oXW7')](()=>$['done']());async function Main(){const ililIl=ililIi,iI1lil={'PHDpa':function(l1lIi1,iIli1l){return l1lIi1(iIli1l);},'UKNkm':function(i1i1II,liiIIl){return i1i1II>=liiIIl;},'yecCv':ililIl(0xe0,'Q!C0'),'HJszI':'⚠\x20请先定义必要的环境变量后再运行脚本','cleqR':function(iil1iI,IlIllI){return iil1iI||IlIllI;},'Sbdkf':ililIl(0x19d,'#PGI'),'JciwF':function(il1i1I,lI1li1){return il1i1I===lI1li1;},'Favgq':ililIl(0x159,'0[9i'),'ZoxCX':function(iI11II,iIII1I){return iI11II||iIII1I;},'PnlhT':function(ilil1i,IlIIi){return ilil1i===IlIIi;},'vUIis':function(IiI1l,illlII){return IiI1l!==illlII;},'eqwDs':ililIl(0x145,'wev)'),'SxggL':'iUeWl','ACQQt':function(iIII11,IiI1i){return iIII11!==IiI1i;},'lQZkM':ililIl(0x178,'B*uP'),'zwOHe':ililIl(0x153,'CPba'),'Gswht':ililIl(0x149,'Z()M'),'XSRzU':function(llll1,lil11l){return llll1(lil11l);},'wievl':function(i1i1Il,I1lIl1){return i1i1Il(I1lIl1);},'DGroK':function(lil11i,IlIIl){return lil11i&&IlIIl;},'oSQhV':function(lI1liI,i1i1Ii){return lI1liI(i1i1Ii);},'PiahJ':function(lllii,iI11Ii){return lllii(iI11Ii);},'SLjYj':ililIl(0xcc,'28oS'),'ERQpq':ililIl(0x1c6,'lF9g'),'nnWzS':function(iIII1l,lllil){return iIII1l(lllil);},'fMXbh':function(iI11Il,iIII1i){return iI11Il>iIII1i;},'BJJfr':function(iil1i1,il1i11){return iil1i1!==il1i11;},'UpuaI':function(IlIll1,IlIII){return IlIll1!==IlIII;},'CPSFr':'rrrkp','SZeDM':function(ilil1l,illlIi){return ilil1l(illlIi);},'Lxqdx':'tljfC','iMTbB':ililIl(0x107,'^VgD')};try{if(!activityArgv){if(iI1lil[ililIl(0xca,'qXV*')](iI1lil[ililIl(0x150,'Osoa')],ililIl(0x1c9,'#H2P'))){console[ililIl(0xf1,'0[9i')](iI1lil[ililIl(0xbc,'WZ#Y')]);return;}else{const illlIl=iI1lil[ililIl(0xf5,'E76f')](I1llii,lilIll);iI1lil[ililIl(0x13d,'tPvs')](illlIl,0x0)&&(iliII1[ililIl(0x12c,'b$v$')]=illlIl);}}try{if(activityArgv['includes'](ililIl(0x17b,'j9Ii'))){const {shopId:i11ill,venderId:IIIIIi,vendorId:IIIIIl}=common[ililIl(0x1b6,'e)Qr')](activityArgv);$[ililIl(0x1a9,'E76f')]=i11ill,$[ililIl(0x1b4,'T9c1')]=iI1lil['ZoxCX'](IIIIIi,IIIIIl);}else{const I1lIil=activityArgv[ililIl(0x112,'#k9L')]('_');if(iI1lil[ililIl(0x1b9,'aBoC')](I1lIil[ililIl(0x111,'$2IK')],0x2))iI1lil['vUIis'](iI1lil[ililIl(0xfe,'tPvs')],iI1lil['SxggL'])?($[ililIl(0x1bf,'28oS')]=I1lIil[0x0],$['venderId']=I1lIil[0x1]):II1lii[ililIl(0x12d,'5uYz')](iI1lil[ililIl(0x130,'#k9L')]);else{if(iI1lil['ACQQt'](ililIl(0x1e9,'wev)'),iI1lil['lQZkM'])){IiilI1[ililIl(0x126,'e#6x')](iI1lil[ililIl(0x139,'!yQu')]);return;}else $['venderId']=I1lIil[0x0];}}}catch{console[ililIl(0xdd,'aBoC')](iI1lil[ililIl(0x1b7,'D@7@')]);return;}finally{if(!$[ililIl(0xd4,'tPvs')]&&!$['shopId']){console[ililIl(0x13f,'j9Ii')](iI1lil['Sbdkf']);return;}}if(!$[ililIl(0x1e1,'#PGI')]||!$[ililIl(0x103,'Osoa')]){if(ililIl(0x1a6,'e)Qr')!==iI1lil['zwOHe']){const {shopId:lllll,venderId:i11ili,vendorId:iil1l1}=II11Ii[ililIl(0x116,'e#6x')](II11Il);IlI11[ililIl(0x103,'Osoa')]=lllll,iIIIIl[ililIl(0x1c3,'LoJP')]=iI1lil[ililIl(0xe7,'aBoC')](i11ili,iil1l1);}else{console[ililIl(0x137,'CPba')](iI1lil[ililIl(0x1c1,'#k9L')]);return;}}let I1lIii;if(!$[ililIl(0xff,'D@7@')]||!$[ililIl(0x11f,'^VgD')]){let lllli=$['venderId']?{'venderId':iI1lil[ililIl(0xb1,'e)Qr')](String,$[ililIl(0xdc,'oXW7')])}:{'shopId':iI1lil[ililIl(0x14b,'#H2P')](String,$['shopId'])},iiili1,ill11i,lllill;for(let ill11l=0x0;ill11l<0x2;ill11l++){iiili1=await common[ililIl(0x15c,'M]cs')](lllli);let I1lIiI=iiili1?.[ililIl(0x19f,'Rtwa')]||{};I1lIii=I1lIiI[ililIl(0x148,'0[9i')]||'',ill11i=I1lIiI['shopId'],lllill=I1lIiI[ililIl(0x1d1,'Rz[K')];if(iI1lil['DGroK'](I1lIii,ill11i)&&lllill)break;lllli=$[ililIl(0x1d4,'e)Qr')]?{'shopId':iI1lil[ililIl(0x197,'b$v$')](String,$[ililIl(0x1b4,'T9c1')])}:{'venderId':iI1lil[ililIl(0x1ad,'wev)')](String,$[ililIl(0x104,'LoJP')])},I1lIii='';}if(!ill11i||!lllill){if(iI1lil['JciwF'](iI1lil[ililIl(0x1ba,'xMuv')],iI1lil[ililIl(0xb0,'#PGI')])){console['log'](iI1lil[ililIl(0x1ca,'Osoa')]);return;}else return;}else $[ililIl(0xd5,'T9c1')]=ill11i,$[ililIl(0x18e,'M]cs')]=lllill;}console[ililIl(0x10b,'Z()M')]((I1lIii?ililIl(0xfb,'Gcrg')+I1lIii+'\x0a':'')+ililIl(0xe1,']IJI')+$[ililIl(0x176,'GcmW')]+'&venderId='+$[ililIl(0xd1,'VgU!')]+'\x0a'),notify['appendContent']((I1lIii?ililIl(0x19c,'b$v$')+I1lIii:'')+ililIl(0x185,'!yQu')+$[ililIl(0x1c4,')!x#')]+'&venderId='+$[ililIl(0x136,'YxA%')]);try{const IliiiI=iI1lil['nnWzS'](parseInt,taskThreads);iI1lil[ililIl(0x140,'&IaN')](IliiiI,0x0)&&iI1lil[ililIl(0x129,'E$V0')](IliiiI,0x1)&&(taskThreads=IliiiI);}catch{taskThreads=0x1;}taskThreads=Math[ililIl(0x179,'B*uP')](taskThreads,0x5),$['waitTime']=null;if(runInterval)try{if(iI1lil[ililIl(0x115,'5uYz')](iI1lil[ililIl(0xc9,'Rtwa')],iI1lil[ililIl(0x128,'Q!C0')])){IiilIi[ililIl(0x18f,'2A00')](iI1lil[ililIl(0x1c8,'GcmW')]);return;}else{const liiIII=iI1lil[ililIl(0x1e3,'xMuv')](parseInt,runInterval);if(iI1lil[ililIl(0xaf,')!x#')](liiIII,0x0)){if(iI1lil['JciwF']('tljfC',iI1lil[ililIl(0x18d,'e)Qr')]))$[ililIl(0x1d3,'Rtwa')]=liiIII;else{i1l1li['log'](iI1lil[ililIl(0xc3,'YxA%')]);return;}}}}catch{console[ililIl(0x192,'!yQu')](iI1lil['iMTbB']);}await common[ililIl(0xfc,'WZ#Y')](taskThreads,cookiesArr,taskFnc);}catch(iI11I1){console[ililIl(0x186,'b$v$')](ililIl(0x16d,'5uYz')+iI11I1);}}async function taskFnc(il1i1l,IlIlll){const liiI1l=ililIi,IIIl1I={'iPmgB':liiI1l(0x1dc,'T9c1'),'FyKKZ':'账号无效','qWpIx':function(lllilI,ilil11){return lllilI!==ilil11;},'XIBAm':'OpafR','IvRhq':liiI1l(0x10d,'aBoC'),'ReMRD':function(illlI1,IIIl11){return illlI1===IIIl11;},'cgXhm':liiI1l(0x1a2,'aBoC'),'Jdboh':'获取活动信息失败','xKGxx':'drawShopGift','iWawe':liiI1l(0x120,'#k9L'),'kamVG':liiI1l(0x15e,'v#]y'),'Brwvm':function(I1lIi1,liiIIi){return I1lIi1!==liiIIi;},'jYWim':'402','qBRjT':liiI1l(0x12a,'WZ#Y'),'lTJjY':liiI1l(0xf6,'E76f'),'UUmbK':liiI1l(0x193,'M]cs'),'ccayv':function(lil11I,Iliii1){return lil11I===Iliii1;},'GuGZY':'jKICd','RDugB':liiI1l(0x11d,'CPba'),'BYzQX':'店铺不存在或获取店铺信息失败','BEUNK':liiI1l(0x1a4,'xMuv'),'xjjKz':'POST','IbdRx':'1218.000000','xvWup':liiI1l(0x118,'tPvs'),'jQiPb':function(iIiIi,iil1ll){return iIiIi||iil1ll;},'LTqOg':'shop_app_home_window','ahMNK':'*/*','nhmhM':'gzip,\x20deflate,\x20br','RvpUc':liiI1l(0x19a,'lF9g'),'vwyik':liiI1l(0x123,'LoJP'),'sZnlp':'empty','DSPfK':'com.360buy.jdmobile','soIyg':function(iiilil,iil1li){return iiilil===iil1li;},'DLrVv':'YXUXI','YWDFv':'Content-Type','qTQip':liiI1l(0x17e,'K(u['),'JKGVL':'YNWVp','VqHbV':function(lillIl,iIiIl,iiilii){return lillIl(iIiIl,iiilii);},'sbEiP':liiI1l(0xf4,'#H2P'),'YVnHC':function(li1i1i,IlIli1){return li1i1i===IlIli1;},'gzFKK':function(illIiI,lI1lli){return illIiI+lI1lli;},'fsVOk':function(Ill1l,llI1Il){return Ill1l+llI1Il;},'ysDkg':liiI1l(0x187,'!yQu'),'fvQvA':function(ii1iii,i11iil){return ii1iii*i11iil;},'Hpdff':function(Ill1i,ii1iil){return Ill1i-ii1iil;},'BisHn':function(lllI1l,i11iii){return lllI1l+i11iii;},'BHiVK':liiI1l(0xb5,'GcmW'),'uPIVt':function(llI1Ii,lllI1i){return llI1Ii(lllI1i);},'mvbjU':liiI1l(0xb3,'j9Ii'),'jPyVR':liiI1l(0xc1,'e)Qr'),'ecwOI':function(li1i1l,II1i1){return li1i1l===II1i1;},'wrBxk':liiI1l(0xcf,'0[9i'),'IDXDN':'取关店铺失败'};if($[liiI1l(0x10e,'E76f')])return{'runEnd':!![]};const iil1ii=decodeURIComponent(common[liiI1l(0x177,'#k9L')](il1i1l,IIIl1I[liiI1l(0x1ce,'B*uP')])),IlIlli=notify[liiI1l(0x1bd,'WZ#Y')](IlIlll,iil1ii),il1i1i=await common[liiI1l(0x131,'47lQ')](il1i1l);if(!il1i1i&&IIIl1I[liiI1l(0x135,'28oS')](typeof il1i1i,liiI1l(0x14c,'#PGI'))){IlIlli[liiI1l(0x183,')!x#')](liiI1l(0x10a,'2A00')),console[liiI1l(0x180,'#H2P')](IlIlli['getInlineContent']());return;}const lil111=common[liiI1l(0xe3,'M]cs')](iil1ii),i11ilI=IIIl1I[liiI1l(0x18c,'28oS')](IIIl1I['fsVOk'](IIIl1I['ysDkg'],Math['floor'](IIIl1I[liiI1l(0xda,'E76f')](Math[liiI1l(0x100,'CPba')](),IIIl1I[liiI1l(0x1c5,'0[9i')](0x2710,0x1869f)))),0x1869f),ii1ii1=IIIl1I[liiI1l(0x152,'Osoa')](IIIl1I[liiI1l(0x1dd,'B*uP')](IIIl1I['BHiVK'],Math['floor'](IIIl1I[liiI1l(0x13a,'Osoa')](Math['random'](),0x2710-0x1869f))),0x1869f),llllI=common['getJEC'](iil1ii),lllil1=common[liiI1l(0x12e,'K(u[')]();let iil1il='',ilil1I='';await IIIl1I['uPIVt'](ii1iiI,IIIl1I[liiI1l(0x1e7,'&IaN')]);if($[liiI1l(0x1df,'Cu6G')])await $[liiI1l(0x1a0,'wev)')]($['waitTime']);if($['runEnd']||!ilil1I){console['log'](IlIlli['getInlineContent']());if($[liiI1l(0x17f,'B*uP')])return{'runEnd':!![]};else return;}else{if(IIIl1I[liiI1l(0x134,'xMuv')](IIIl1I['mvbjU'],liiI1l(0x1ab,'T9c1'))){llIlil[liiI1l(0x110,'&IaN')](IIIl1I[liiI1l(0xc8,'#PGI')]),IIlil[liiI1l(0x1a5,'B*uP')](ilI1lI['getInlineContent']());return;}else{iil1il=ilil1I?.[liiI1l(0x172,'aBoC')];if(!iil1il){IlIlli[liiI1l(0xb7,'E76f')](IIIl1I[liiI1l(0x15f,'e)Qr')]),console[liiI1l(0x180,'#H2P')](IlIlli[liiI1l(0x171,'VgU!')]());return;}}}if(ilil1I[liiI1l(0x1cc,'47lQ')]){if(liiI1l(0x119,'oXW7')===IIIl1I[liiI1l(0x147,']IJI')]){const iIiII=await common[liiI1l(0xce,'qXV*')](![],$['shopId'],il1i1l);if(!iIiII&&IIIl1I[liiI1l(0xe2,'#V9t')](typeof iIiII,'boolean')){if(IIIl1I['qWpIx'](IIIl1I[liiI1l(0xfd,']IJI')],IIIl1I['wrBxk']))iIIl11[liiI1l(0x1b8,'Rtwa')]('❌\x20脚本运行遇到了错误\x0a'+l1l1I1);else{IlIlli[liiI1l(0xb7,'E76f')](IIIl1I[liiI1l(0xf0,'Osoa')]),console[liiI1l(0x1c0,'#k9L')](IlIlli[liiI1l(0x182,'5uYz')]());return;}}}else{const li1i1I=II1Ii[liiI1l(0x184,'#V9t')]('_');li1i1I[liiI1l(0xba,'j9Ii')]===0x2?(lI1Il1[liiI1l(0xc5,'6s2M')]=li1i1I[0x0],lilIi1[liiI1l(0x102,'K(u[')]=li1i1I[0x1]):IiilII[liiI1l(0xd1,'VgU!')]=li1i1I[0x0];}}if($[liiI1l(0x1df,'Cu6G')])await $[liiI1l(0x1b5,'CPba')]($[liiI1l(0x11b,']IJI')]);await IIIl1I['uPIVt'](ii1iiI,liiI1l(0x14d,'tPvs'));if($[liiI1l(0x11e,'Z()M')])return console[liiI1l(0xdd,'aBoC')](IlIlli[liiI1l(0x164,'j9Ii')]()),{'runEnd':!![]};if($[liiI1l(0x1b1,'&IaN')])await $[liiI1l(0x174,'WZ#Y')]($['waitTime']);console[liiI1l(0x180,'#H2P')](IlIlli[liiI1l(0x1db,'#PGI')]());function i11il1(illIii,ii1il1){const i1l1II=liiI1l;if(IIIl1I[i1l1II(0x1b2,'#k9L')](IIIl1I[i1l1II(0x1ae,'M]cs')],IIIl1I[i1l1II(0x17d,'*$$[')])){Illl1l=Illl1i?.[i1l1II(0x151,'2A00')];if(!lIIiil){IiiIli[i1l1II(0x1cb,'Q!C0')](IIIl1I['iPmgB']),iillli[i1l1II(0x16c,'*$$[')](I1l1Ii[i1l1II(0x18b,'Rtwa')]());return;}}else try{switch(illIii){case IIIl1I[i1l1II(0x166,'#k9L')]:if(IIIl1I['ReMRD'](ii1il1['code'],'0')&&ii1il1[i1l1II(0xcb,'28oS')]&&ii1il1['result'])ilil1I=ii1il1[i1l1II(0xee,'#H2P')];else ii1il1['message']?(IlIlli['fix'](ii1il1[i1l1II(0xf8,'tPvs')]),ii1il1['message'][i1l1II(0x1b0,'Q!C0')](IIIl1I['cgXhm'])&&($[i1l1II(0x1bc,'*$$[')]=!![])):IlIlli['fix'](IIIl1I[i1l1II(0x11a,'tPvs')]);break;case IIIl1I[i1l1II(0x1d8,'28oS')]:if(ii1il1[i1l1II(0x12f,'YxA%')]==='0'&&ii1il1['isSuccess']&&ii1il1[i1l1II(0xf2,'YxA%')]){const {followCode:illIil,followDesc:Ill1I,giftCode:i11iiI,giftDesc:lIli11,alreadyReceivedGifts:lllI1I}=ii1il1[i1l1II(0x175,'#V9t')];switch(illIil){case IIIl1I[i1l1II(0x190,'lF9g')]:switch(i11iiI){case IIIl1I[i1l1II(0x121,'Rz[K')]:for(const lillI1 of lllI1I){if(IIIl1I[i1l1II(0x127,']IJI')]('nEzpi',i1l1II(0x14f,'e)Qr'))){let IlIlii=[lillI1?.[i1l1II(0x1be,'v#]y')],lillI1?.[i1l1II(0x191,'Gcrg')]]['join']('');switch(lillI1?.['prizeType']){case 0x1:case 0x2:case 0x3:IlIlli[i1l1II(0x1e6,'xMuv')](IlIlii+i1l1II(0x117,'Gcrg'));break;case 0x4:IlIlli['insert'](IlIlii+'🐶');break;case 0x6:IlIlli[i1l1II(0x1c2,'e)Qr')](IlIlii+i1l1II(0x19b,'aBoC'));break;default:IlIlli['insert'](IlIlii);break;}}else iIIl1l[i1l1II(0x1e2,']IJI')]=llIli1,iliIII[i1l1II(0x136,'YxA%')]=iIIl1i;}break;case IIIl1I[i1l1II(0x1b3,'v#]y')]:console['log'](lIli11),IlIlli['insert'](lIli11);break;case IIIl1I[i1l1II(0x158,'tPvs')]:IlIlli['fix'](i1l1II(0xb4,'qXV*'));break;default:!lllI1I?IlIlli['fix'](i1l1II(0x189,'#k9L')+i11iiI+'）'):(console[i1l1II(0x181,'v#]y')](i1l1II(0xe6,'Z()M')+JSON['stringify'](ii1il1[i1l1II(0xd7,'oXW7')])),IlIlli['fix'](IIIl1I[i1l1II(0xdf,'oXW7')]));break;}break;case IIIl1I[i1l1II(0x199,'Z()M')]:IlIlli[i1l1II(0x18a,'oXW7')](Ill1I);break;default:console['log'](i1l1II(0x1a1,'VgU!')+JSON[i1l1II(0x1e8,'M]cs')](ii1il1[i1l1II(0xd9,'Cu6G')])),IlIlli['fix'](i1l1II(0xcd,'aBoC'));}}else ii1il1[i1l1II(0x144,'LoJP')]?IlIlli[i1l1II(0x183,')!x#')](ii1il1[i1l1II(0xbb,'v#]y')]):(console[i1l1II(0x1da,'YxA%')]('❓'+illIii+'\x20'+JSON[i1l1II(0x14a,'lF9g')](ii1il1)),IlIlli['fix']('未知奖品领取状态'));break;}}catch(liil11){if(IIIl1I[i1l1II(0x17a,'GcmW')](IIIl1I[i1l1II(0x132,'#PGI')],IIIl1I[i1l1II(0xb2,'RBA*')])){I1ilI1[i1l1II(0xef,'b$v$')](IIIl1I[i1l1II(0x16f,'Rtwa')]),iillll[i1l1II(0x141,'^VgD')](lIIilI[i1l1II(0x1db,'#PGI')]());return;}else console['log'](i1l1II(0x109,'oXW7')+illIii+'\x20请求响应\x20'+(liil11[i1l1II(0x143,'B*uP')]||liil11));}}async function ii1iiI(l1l111){const i1ill=liiI1l;if($[i1ill(0x198,'^VgD')])return;let l1iIII='',llI1I1=null,IlIlil=null,lIli1I=IIIl1I[i1ill(0x14e,'j9Ii')],II1il={};switch(l1l111){case IIIl1I[i1ill(0x168,'B*uP')]:l1iIII=i1ill(0xde,'0[9i'),II1il={'shopId':''[i1ill(0x12b,'2A00')]($['shopId']||''),'source':'app-shop','displayWidth':IIIl1I[i1ill(0x194,'Z()M')],'sourceRpc':IIIl1I[i1ill(0x163,'Rz[K')],'lng':ii1ii1,'lat':i11ilI,'venderId':''[i1ill(0xf9,'B*uP')]($['venderId']||'')},IlIlil={'functionId':IIIl1I[i1ill(0xd8,'Rtwa')]},llI1I1=common[i1ill(0x15d,'^VgD')](await common[i1ill(0x1cf,'xMuv')](IIIl1I[i1ill(0x13e,'e)Qr')],II1il));break;case IIIl1I[i1ill(0xc4,'tPvs')]:l1iIII=i1ill(0x155,'e#6x'),II1il={'follow':0x0,'shopId':''[i1ill(0x15a,'Gcrg')]($[i1ill(0x1a3,'#V9t')]||''),'activityId':''['concat'](IIIl1I[i1ill(0x10f,'K(u[')](iil1il,'')),'sourceRpc':IIIl1I[i1ill(0xbd,'LoJP')],'venderId':''[i1ill(0x1bb,'0[9i')]($[i1ill(0x161,'5uYz')]||'')},IlIlil={'functionId':i1ill(0x1e4,'K(u[')},llI1I1=common['queryStringToObject'](await common[i1ill(0xf3,'Osoa')](IIIl1I[i1ill(0x1d7,'oXW7')],II1il));break;default:console[i1ill(0x1a8,'WZ#Y')]('❌\x20未知请求\x20'+l1l111);return;}const lllI11={'url':l1iIII,'method':lIli1I,'headers':{'Accept':IIIl1I['ahMNK'],'Accept-Encoding':IIIl1I['nhmhM'],'Accept-Language':'zh-Hans-CN;q=1,\x20en-CN;q=0.9,\x20zh-Hant-CN;q=0.8','Connection':IIIl1I['RvpUc'],'Content-Type':IIIl1I['vwyik'],'Cookie':il1i1l,'J-E-H':lllil1,'J-E-C':llllI,'Sec-Fetch-Dest':IIIl1I[i1ill(0xd0,'M]cs')],'Sec-Fetch-Mode':i1ill(0xe9,'5uYz'),'Sec-Fetch-Site':'same-origin','User-Agent':lil111,'x-referer-package':IIIl1I[i1ill(0x105,'*$$[')],'x-rp-client':'ios_4.0.0'},'params':IlIlil,'data':llI1I1,'timeout':0x7530};if(IIIl1I['soIyg'](lIli1I,i1ill(0x1cd,'47lQ'))){if(IIIl1I['DLrVv']===IIIl1I[i1ill(0xed,'LoJP')])delete lllI11[i1ill(0x1de,'47lQ')],delete lllI11[i1ill(0x162,'wev)')][IIIl1I[i1ill(0x1d9,'K(u[')]];else{I1iIiI[i1ill(0x16a,'LoJP')](IIIl1I[i1ill(0x195,'E76f')]);return;}}const I1lIll=0x1;let I1lIli=0x0,II1ii=null,IIIIII=![];while(I1lIli<I1lIll){const ii1ilI=await common[i1ill(0x1aa,'e#6x')](lllI11);if(!ii1ilI['success']){if(IIIl1I['soIyg'](i1ill(0xc7,'VgU!'),IIIl1I[i1ill(0x173,'*$$[')]))lilIl1[i1ill(0x106,'Z()M')](i1l1ii[i1ill(0x160,'qXV*')],IIIl1I[i1ill(0xeb,'5uYz')]),i1l1[i1ill(0x1ac,'5uYz')](0x1);else{II1ii=i1ill(0xb6,'tPvs')+l1l111+i1ill(0xc6,'Osoa')+ii1ilI[i1ill(0x114,'Rtwa')],I1lIli++;continue;}}if(!ii1ilI[i1ill(0x125,'E76f')]){if(i1ill(0x142,'RBA*')!==IIIl1I['JKGVL'])l1iii[i1ill(0xd3,'D@7@')]=!![];else{II1ii=i1ill(0xea,'Osoa')+l1l111+i1ill(0x13c,'28oS'),I1lIli++;continue;}}IIIl1I[i1ill(0xe8,'*$$[')](i11il1,l1l111,ii1ilI['data']),IIIIII=![];break;}I1lIli>=I1lIll&&(console[i1ill(0x165,'6s2M')](II1ii),IIIIII&&($[i1ill(0xe4,'CPba')]=!![]));}}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
